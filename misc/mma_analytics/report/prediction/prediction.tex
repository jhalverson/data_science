\clearpage
\section{Predicting the Winner}

In this section we create several models to try to predict
the winner. We start we simple models based on rules
and move on to machine learning models such as
random forest, support vector machine and extreme
gradient boosting.

\subsection*{Simple Rules}

If we exclude no contests and draws, since January 1, 2005,
there have been 3561 UFC fights with a winner and loser.
Table~\ref{table_simple_rules} shows the accuracy score
for several simple rule-based models. For instance, if
our model is that the younger fighter always wins, we would
be correct 1964 times out of 3529 fights or 55.7\%. Note that
there are 32 excluded fights where either the dates of birth
are unknown or both fighters have the same date of birth.

\begin{center}
\begin{table}[h]
\begin{tabular}{r|ccccc}
  \toprule
  Model & Accuracy & Wins & Total & Excluded & $\log_{10}p$\\
  \hline
  Lesser age wins & 55.7\% & 1964 & 3529 & 32 & $-11$\\
  Lesser age by 4 years or more wins & 59.1\% & 893 & 1511 & 2050 & $-12$\\
  Greater reach wins & 52.4\% & 1499 & 2863 & 698 & $-2$\\
  Greater reach by 4 inches or more wins & 55.5\% & 523 & 942 & 2619 & $-4$\\
  Greater height wins & 51.2\% & 1486 & 2903 & 658 & $-0.7$\\
  Greater leg reach wins & 49.0\% & 487 & 993 & 2568 & $-0.2$\\
  Southpaw (vs. orthodox) wins & 55.5\% & 561 & 1010 & 2551 & $-4$\\
  Education (vs. no education) wins & 56.5\% & 594 & 1051 & 2510 & $-5$\\
  Greater number of UFC fights wins & 55.6\% & 1606 & 2886 & 675 & $-9$\\
  Fighter who fought more recently wins & 51.8\% & 1220 & 2353 & 1208 & $-1.1$\\
  Greater previous win ratio wins & 58.6\% & 434 & 740 & 2821 & $-6$\\
  Current or former champion wins & 61.8\% & 175 & 283 & 3278 & $-5$\\
  \hline
  Lesser age and greater reach wins & 57.2\% & 919 & 1607 & 1954 & $-9$\\
  Southpaw and lesser age wins & 61.7\% & 284 & 460 & 3101 & $-7$\\
  Southpaw, lesser age and greater reach wins & 62.0\% & 132 & 213 & 3348 & $-4$\\
  Greater previous win ratio and lesser age wins & 61.9\% & 252 & 407 & 3154 & $-6$\\
  \bottomrule
\end{tabular}
\caption{Accuracy scores for simple rule-based models. For models where win ratio was used, we only considered
fighters with 5 or more UFC fights. $p$-values are given in the rightmost column. Note that for $p=0.05$, $\log_{10}p = -1.3$. In all
cases the sum of 
Total and Excluded is 3561.}
\label{table_simple_rules}
\end{table}
\end{center}

In computing the number of previous UFC fights for each fighter, we start
counting with UFC 1. We ignored no contests but draws were included. A fighter's
win ratio is their number of UFC wins divided by their
total number of UFC fights (including draws).

\subsection*{Machine Learning Models}

For each fighter we have the following features:

\begin{itemize}[noitemsep]
  \item Height
  \item Reach
  \item Leg reach
  \item Stance (orthodox, southpaw or switch)
  \item Age
  \item Education (yes or no)
  \item Current or former champion (yes or no)
  \item Number of previous UFC fights
  \item Total time in the Octogon
  \item Elapsed time since last UFC fight
  \item Win percentage of UFC fights
  \item Percentage of wins by KO/TKO
  \item Percentage of wins by submission
  \item Percentage of wins by decision
  \item Percentage of losses by KO/TKO
  \item Percentage of losses by submission
\end{itemize}

\noindent
We also use the following career statistics:

\begin{itemize}[noitemsep]
  \item Significant strikes landed per minute
  \item Significant striking accuracy
  \item Significant strikes absorbed per minute
  \item Significant strike defense
  \item Average takedowns landed per 15 minutes
  \item Takedown accuracy
  \item Takedown defense
  \item Average submissions attempted per 15 minutes
\end{itemize}

\noindent
The derived features are

\begin{itemize}[noitemsep]
  \item Difference in age, reach, number of fights, and so on of the two fighters
  \item Total damage = total fight time times strikes absorbed per minute
  \item Total strikes thrown per minute = SlPM / striking accuracy
  \item Natural logarithm of elapsed time since last UFC fight
  \item Fighter versatility index = (3/2)((1/3)/(W2+W2+W2) - 1/3)
\end{itemize}

\noindent
These features depend on both fighters:

\begin{itemize}[noitemsep]
  \item Expected strikes absorbed per minute1 = string defense1 * (SlPM / striking accuracy)2
  \item TKO susceptibility $(\textrm{LTKO}_1 \times \textrm{WTKO}_2)^{1/2}$
  \item Submission susceptibility $(\textrm{LSUB}_1 \times \textrm{WSUB}_2)^{1/2}$
\end{itemize}

The class label is a 0 if fighter 1 beats fighter 2 or
a 1 if fighter 2 beats fighter 1.
There are approximatley
equal numbers of each class label.

As always we need discriminatory features.

An additional feature would be an indicator variable
which would be unity for champions and interim champions
and zero otherwise. The idea here is that champions
impose fear in their opponents which gives them a slight
advantage. Even former champions.

Another idea is to rate wins and losses. Losing to a good
opponent should hurt you less and beating a good fighter
should get you more. Hence the win ratio should be
weighted. In this study the ratio was unweighted.

Fighters who are susceptible to TKO or submission
losses and fighting an opponent who is particularly
good at either of their should enter.

In many ways the anthropomorphic features are taken
into account by the other metrics and vice versa.
You can't have a great win ratio without being
young and have reach?

The idea is make columns of differences between
quantities. For instance, the difference in
height is $\Delta h = h_1 - h_2$. One could also leave
in the height values of 1 or 2 but we assume this has
little discriminatory power.

\subsection*{Prediction}

One could impute missing data. For instance, leg reach
could be inferred by using height and reach data for
each weight class. For simplicity we ignore fights
where data is missing. This includes cases where one
of the fights did not use the orthodox or southpaw
stances. We are left with 2940 fights.

It is important to note that match makers try to make
the fights fair. This is to prevent fighters from taking
a beating and to make sure they are at the right level.

The idea is to randomly choose 70\% of the fights and
use those to train a model using supervised
learning techniques.
Training a model is a mathematical optimization problem.
There are several different models. Some 
In many cases a function with a given form is presented
and the goal is to find the set of coefficients or weights
which minimize a prescribed error function. In the present
case we seek to optimize the accuracy.
Once the model has been
trained we use it to make fight predictions on
the remaining 30\% of the fights. We then report the
accuracy of the model on the test data.

\begin{center}
\begin{table}[h]
\begin{tabular}{c|cccccc}
  \toprule
  {} &  \multicolumn{2}{c}{{Fighter 1}} & \multicolumn{2}{c}{{Fighter 2}} & Fighter 1 $-$ Fighter 2 & Fighter 1 / Fighter 2\\
  \hline
  Outcome & Age & Reach & Age & Reach & $\textrm{SLpM}_1 - \textrm{SLpM}_2$ & $\textrm{WTKO}_1/\textrm{LTKO}_2$\\
  \hline
  1 & 23.2 & 72.0 & 31.0 & 70.0 & 1.1 & 3.1\\
  0 & 33.5 & 67.0 & 29.9 & 68.0 & $-0.7$ & 0.9\\
  1 & 27.1 & 78.0 & 36.3 & 74.0 & 0.9 & 1.8\\
  \bottomrule
\end{tabular}
\caption{Accuracy scores for simple rule-based models. For models where win ratio was used, we only considered
fighters with 5 or more UFC fights. $p$-values are given in the rightmost column. Note that for $p=0.05$, $\log_{10}p = -1.3$. In all
cases the sum of
Total and Excluded is 3561.}
\label{sample_labels_features}
\end{table}
\end{center}


We create predictive models using the 3561 fights since
January 1, 2005. The idea is to split the data into
training and test sets. We use a 70/30 split. We then
use stratified K-fold cross validation with 10 folds
to find the optimal
hyperparameters for a given model. The model is then
used to make predictions about the test data. The accuracy
is computed.

For non-tree based methods, it is necessary to standardize
each column. The standardizer is applied in preprocessing to
the test data.


\begin{center}
\begin{table}[h]
\begin{tabular}{r|cccc}
  \toprule
   & Random Forest & Logistic Reg. & Multilayer Perceptron \\
  Features & Accuracy & Accuracy& Accuracy \\
  \hline
  $a$ & 52.4\% & 55.9\% & 55.6\%\\
  $r$ & 52.2\% & 52.1\% & 51.9\%\\
  $h$, $r$ & 52.9\%  & 52.1\% & \\
  $\Delta h$, $\Delta r$ & 51.6\% & 51.6\%  &\\
  $h$, $\Delta h$, $r$, $\Delta r$ & 52.0\% & 51.9\%  &\\
  $h$, $r$, $l$ & 56.6\% & 51.9\% &  \\
  $\Delta h$, $\Delta r$, $\Delta l$ & 50.7\% & 52.2\%  &\\
  $\Delta h$, $\Delta r$, $\Delta l$, $\Delta a$ & 52.4\% & 55.1\% & 55.4\% \\
  $h$, $r$, $a$ & 53.4\% & 54.7\% &  \\
  $h$, $r$, $a$, $a^2$ & 53.4\% & 55.1\% &  \\
  $r/h$, $a^2$ & 54.3\% & 55.1\% & 55.2\%  \\
  $h$, $r$, $l$, $a$ & 56.1\% & 54.9\% &  \\
  $h$, $r$, $l$, $a$, $\Delta h$, $\Delta r$, $\Delta l$, $\Delta a$ & 55.8\% & 54.9\%  &\\
  $osw$ & 52.3\% & 52.3\% & 52.3\%\\
  $a$, $osw$ & 51.0\% & 55.0\% & \\
  $r$, $a$, $osw$ & 53.5\% & 55.7\% &  \\
  $r$, $l$, $a$, $osw$ & 56.1\% & 55.4\% & \\
  $h$, $r$, $l$, $a$, $osw$ & 56.7\% & 55.3\% &  \\
  $h$, $r$, $l$, $a$, $osw$, $\Delta h$, $\Delta r$, $\Delta l$, $\Delta a$, $\Delta osw$ & 56.0\% & 54.8\% &  \\
  \bottomrule
\end{tabular}
\caption{Accuracy scores for different machine learning classifiers which were trained
on age, stance and anthropometric measurements only.
$a$ is age, $h$ is height, $r$ is reach, $l$ is leg reach,
$osw$ stands for three indicator variables for orthodox, southpaw,
switch and $\Delta$ is the difference in one of the features between the two
fighters. For instance, in the third row the models were trained on
four features or the height and reach of both fighters (i.e., $h_1$, $r_1$, $h_2$, $r_2$)
whereas in the fourth row only two features were used (i.e., $h_1-h_2$ and $r_1-r_2$).}
\label{anthropomorphic_features}
\end{table}
\end{center}



\begin{center}
\begin{table}[h]
\begin{tabular}{r|cccc}
\toprule
         & RF       & Logistic Reg. & MLP      & AdaBoost\\
Features & Accuracy & Accuracy      & Accuracy & Accuracy\\
\hline
$w_r$ & 54.0\% & 55.0\% & 55.9\% & \\
$\Delta w_r$ & 52.1\% & 55.5\% & 55.5\% & \\
$w_r$, $n_f$ & 52.7\% & 55.1\% & 53.7\% & \\
$w_r$, $n_f$, $n_w$ & 53.4\% & 55.8\% &  & \\
$w_r$, $a$ & 55.5\% & 57.5\% & 56.6\% & \\
$\Delta w_r$, $\Delta a$ & 53.3\% & 57.6\% & 57.3\% & \\
$n_f$, $n_w$, $a$, $r$ & 55.1\% & 57.0\% \\
$n_f$, $n_w$, $a$, $r$, $h$, $l$, $c$ & 57.8\% & 58.0\% & &\\
$n_f$, $n_w$, $a$, $r$, $h$, $l$, $osw$ & 57.2\% & 58.8\% & & 58.1\%\\
$n_f$, $n_w$, $a$, $r$, $h$, $l$, $osw$, $c$, $e$ & 58.0\% & 58.8\% & &\\
$n_f$, $n_w$, $a$, $r$, $h$, $l$, $osw$, $c$, $e$, $s_a$ & 58.0\% & 58.5\% & & \\
$n_f$, $n_w$, $a$, $r$, $h$, $l$, $osw$, $c$, $e$, $s_a$, $s_l$ & 57.9\% &59.1\% &58.9\% & \\
$n_f$, $n_w$, $a$, $r$, $h$, $l$, $osw$, $c$, $e$, $a_s$ & 58.6\% & 58.4\% \\
$n_f$, $n_w$, $a$, $r$, $h$, $l$, $osw$, $c$, $e$, $\Delta s_r$ & 57.8\% & 58.2\% & 58.4\% & 58.1\%\\
$n_f$, $n_w$, $a$, $r$, $osw$, $c$ & 56.6\% & 58.9\% & 58.5\% \\
$n_f$, $n_w$, $a$, $r$, $osw$, $c$, $h$, $l$ & 57.9\% & 59.0\% & &\\
$a$, $r$, $s_l$ & 54.9\% & 56.2\% & & \\
$a$, $r$, $d_t$ & 54.3\% & 56.1\% & & \\
$a$, $r$, $s_a$ & 55.7\% & 57.1\% & & \\
all 121 features & 58.1\% & 59.3\% & 59.1\% & \\
\bottomrule
\end{tabular}
\caption{$w_r$ is win ratio, $s_l$ is significant strikes landed per minute,
$s_a$ is significant strikes absorbed per minute, $a_s$ is striking accuracy,
$s_r$ is striking ratio, $d_t$ is average number of takedowns per 15 mintues,
$n_f$ is number of previous UFC fights, $n_w$ is number
of UFC wins, $c$ is the champion indicator variable, $e$ is college graduate.}
\label{other_features}
\end{table}
\end{center}




\begin{center}
\begin{table}[h]
\begin{tabular}{ccr|ccc}
\toprule
Min. Number &        &         & RF        & Logistic Reg. & MLP      \\
of Fights & Fights & Features & Accuracy & Accuracy      & Accuracy\\
\hline
0  & 3300 & all 121 features & 58.1\% & 59.3\% & 59.1\% \\
2  & 1740 & all 121 features & 59.9\% & 58.4\% &  \\
4  & 1006 & all 121 features & 58.3\% & 59.8\% &   \\
4  & 1006 & $w_r$ & 52.5\% & 57.4\% & 57.4\%  \\
4  & 1006 & $w_r$, $a$ & 56.9\% & 58.9\% & 56.7\%  \\
4  & 1006 & $w_r$, $a$, $r$, $h$, $l$, $osw$ & 57.9\% & 58.6\% & 56.0\%\\
4  & 1006 & $w_r$, $a$, $s_l$, $s_a$ & 59.0\% & 60.0\% & 59.9\%  \\
4  & 1006 & $w_r$, $a$, $d_t$, $d_f$ & 57.4\% & 58.0\% & 56.1\%  \\
4  & 1006 & $w_r$, $a$, $s_r$ & 59.1\% & 60.8\% & 61.0\%  \\
4  & 1006 & $n_w$, $w_r$, $a$, $r$, $h$, $l$, $osw$, $c$, $e$, $s_r$, $s_l$, $s_a$, $d_t$ & 60.0\% & 59.8\% & 56.5\%  \\
6  &  586 & all 121 features & 59.9\% & 60.0\% & 54.5\% \\
8  &  343 & all 121 features & 58.5\% & 61.1\% & 54.0\% \\
10 &  196 & all 121 features & 58.0\% & 56.6\% & 53.6\% \\
\bottomrule
\end{tabular}
\caption{$d_f$ is average takedown defense}
\label{other_features}
\end{table}
\end{center}


% use career statistics
\begin{center}
\begin{table}[h]
\begin{tabular}{r|ccc}
\toprule
         & RF       & Logistic Reg. & MLP     \\
Features & Accuracy & Accuracy      & Accuracy\\
\hline
all 145 features & 66.0\% & 66.3\% & 66.0\% \\
8 career stats & 65.6\% & 66.3\% & 66.2\% \\
$\hat{s}_l$, $\hat{s}_a$ & 62.5\% & 64.4\% & 66.0\% \\
$s_l$, $s_a$ & 52.9\% & 56.8\% & 56.5\% \\
$\hat{s}_l$, $\hat{s}_a$, $d_t$ & 64.0\% & 65.0\% & 65.3\% \\
\bottomrule
\end{tabular}
\caption{}
\label{other_features}
\end{table}
\end{center}




\begin{figure}[h]
\begin{center}
\includegraphics[width=11cm]{prediction/rf_importances.pdf}
\caption{Feature importances of the random forest model.}
\label{rf_importances}
\end{center}
\end{figure}

\begin{figure}[h]
\begin{center}
\includegraphics[width=11cm]{prediction/lack_of_ufc_fights.pdf}
\caption{Percentage of fights between inexperienced UFC fighters.}
\label{lack_of_ufc_fights}
\end{center}
\end{figure}

One reason why predictions are so difficult is the lack of history
of the fighters. Of the 3300 fights, 892 fights one or both
fighters are making their debut. Because we ignore their previous
fights in other promotions we know nothing about them. Moreover,
70\% of the fights at least one of the fighters has three previous
UFC fights or less. The stats get screwed up if they don't have
a representative fights in the past.

Jon, make a table of accuracy when only considering an increasing
number of fights.

\begin{center}
\begin{table}[h]
\begin{tabular}{r|ccccc}
  \toprule
  Model & Accuracy & Notes\\
  \hline
  Decision trees & 60.7\% & Varied depth of tree and splitting criterion\\
  Random forest & 63.5\% & Varied number of estimators and splitting criterion\\
  Logistic regression & 65.6\% & Varied regularization parameter and L1/L2\\
  Adaptive Boosting & 55.7\% & Varied learning rate\\
  Support Vector Classifier & \% & Varied linear and nonlinear kernels\\
  Bagging with Logistic Regression & \% & Varied number of estimators and regularization\\
  \bottomrule
\end{tabular}
\caption{Accuracy scores for simple rule-based models. For models where win ratio was used, we only considered
fighters with 5 or more UFC fights. $p$-values are given in the rightmost column. Note that for $p=0.05$, $\log_{10}p = -1.3$. In all
cases the sum of
Total and Excluded is 3561.}
\label{table_ML_models}
\end{table}
\end{center}

The accuracy scores of various predictive models are found in Table~\ref{table_ML_models}.
We see the best model was found to be random forest with an accuracy of 56\%. This is
surprising given that the rule-based models in Table~\ref{table_simple_rules} had a
similar predictive power even though they were limited to a subset of the fights.
In the end the prediction is difficult because matchmakers try to pair fighters with
roughly equal ability.

\begin{center}
\begin{table}[h]
\input{prediction/single_feature_logistic.tex}
\caption{Accuracy and Brier scores for single features using logistic regression.}
\end{table}
\end{center}

What is the effect of guessing the initial values? How many fights have
at least one fighter new? Note that many quantities fluctuate dramatically
during the first few fights. This can cause problems. How many fights take
place between fighters with fewer than 5 fights?

Why does using the career statistics improve the model so much? What
happens if we only consider fights between fighters with a large number
of fights and we use the upto fight statistics? 



